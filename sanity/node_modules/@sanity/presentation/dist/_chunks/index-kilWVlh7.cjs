"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),o=require("@sanity/icons"),r=require("@sanity/ui"),i=require("styled-components"),s=require("sanity/router"),a=require("rxjs"),c=require("@sanity/uuid");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=l(i);const d=o.ComposeIcon,p="presentation",m="Presentation",x=t.createContext(null),h={locations:[]};const f={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},v={positive:o.InfoOutlineIcon,caution:o.WarningOutlineIcon,critical:o.ErrorOutlineIcon};function j(i){const{documentId:s,options:c,schemaType:l,showPresentationTitle:u}=i,d=t.useContext(x),{message:j,locations:y,tone:b}=function(e){const{id:o,locate:r,type:i}=e,s=n.useDocumentStore(),[c,l]=t.useState(h);return t.useEffect((()=>{if(!r)return;const e=r({id:o,type:i},{documentStore:s}),t=(a.isObservable(e)?e:a.of(e)).subscribe((e=>l(e||h)));return()=>t.unsubscribe()}),[s,o,r,i]),c}({id:s,locate:c.locate,type:l.name}),I=(null==y?void 0:y.length)||0,[T,w]=t.useState(!1),C=t.useCallback((()=>w((e=>!e))),[]),P=j||(I?e.jsxs(e.Fragment,{children:["Used on ",f[I]||I," ",1===I?e.jsx(e.Fragment,{children:"page"}):e.jsx(e.Fragment,{children:"pages"})]}):null);return 0!==I||P?e.jsx(r.Card,{padding:1,radius:3,border:!0,tone:b,children:e.jsxs("div",{style:{margin:-1},children:[!y&&e.jsxs(r.Flex,{align:"flex-start",gap:3,padding:3,children:[b&&e.jsx(r.Box,{flex:"none",children:e.jsx(r.Text,{size:1,children:t.createElement(v[b])})}),e.jsx(r.Box,{flex:1,children:e.jsxs(r.Text,{size:1,weight:"medium",children:[u&&e.jsxs(e.Fragment,{children:[c.title||m," · "]}),P]})})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(r.Card,{as:"button",onClick:C,padding:3,radius:2,tone:"inherit",children:e.jsxs(r.Flex,{gap:3,children:[e.jsx(r.Box,{flex:"none",children:e.jsx(r.Text,{size:1,children:e.jsx(o.ChevronRightIcon,{style:{transform:"rotate(".concat(T?"90deg":0,")"),transition:"transform 100ms ease-in-out"}})})}),e.jsx(r.Box,{flex:1,children:e.jsxs(r.Text,{size:1,weight:"medium",children:[u&&e.jsxs(e.Fragment,{children:[c.title||m," · "]}),P]})})]})}),e.jsx(r.Stack,{hidden:!T,marginTop:1,space:1,children:y.map(((t,n)=>e.jsx(g,{active:(c.name||p)===(null==d?void 0:d.name)&&t.href===(null==d?void 0:d.params.preview),documentId:s,documentType:l.name,node:t,toolName:c.name||p},n)))})]})]})}):null}function g(n){const{documentId:i,documentType:a,node:c,active:l,toolName:u}=n,d=t.useContext(x),p=null==d?void 0:d.navigate,m=s.useIntentLink({intent:"edit",params:{id:i,type:a,mode:"presentation",presentation:u,...null==d?void 0:d.deskParams,preview:c.href}}),h=t.useCallback((()=>{null==p||p({},{preview:c.href})}),[c.href,p]);return t.createElement(r.Card,{...d?{}:m,as:d?"button":"a",key:c.href,onClick:h,padding:3,radius:2,pressed:l,tone:"inherit"},e.jsxs(r.Flex,{gap:3,children:[e.jsx(r.Box,{flex:"none",children:e.jsx(r.Text,{size:1,children:e.jsx(o.DesktopIcon,{})})}),e.jsxs(r.Stack,{flex:1,space:2,children:[e.jsx(r.Text,{size:1,weight:"medium",children:c.title}),e.jsx(r.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}const y=t.createContext(null);var b,I=Object.freeze,T=Object.defineProperty;const w=u.default(r.Stack)(b||(b=I(T(C=["\n  min-height: ",";\n\n  & + &:empty {\n    display: none;\n  }\n"],"raw",{value:I(P||C.slice())}))),r.rem(42));var C,P;function S(n){var o;const{documentId:i,options:s,schemaType:a}=n,c=t.useContext(y);if(c&&c.options[0]!==s)return e.jsx(w,{marginBottom:5,space:5});const l=(null==(o=null==c?void 0:c.options)?void 0:o.length)||0;return e.jsx(w,{marginBottom:5,space:5,children:e.jsx(r.Stack,{space:2,children:null==c?void 0:c.options.map(((t,n)=>e.jsx(j,{documentId:i,options:t,schemaType:a,showPresentationTitle:l>1},n)))})})}function k(n){const{children:o,options:r}=n,i=t.useContext(y),s=null==i?void 0:i.register,[a,c]=t.useState((()=>[])),l=t.useCallback((e=>s?s(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[s]),u=t.useRef(l);u.current=l;const d=t.useMemo((()=>({options:(null==i?void 0:i.options)||a,register:l})),[a,i,l]);return t.useEffect((()=>u.current(r)),[r]),e.jsx(y.Provider,{value:d,children:o})}const q=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:r,path:i}){const a=n.useWorkspace(),{navigateIntent:c}=s.useRouter(),l=t.useContext(x),u=t.useMemo((()=>function(e,t,o){var r;const i=e.map((e=>{var n;return{tool:e,match:null==(n=e.canHandleIntent)?void 0:n.call(e,"edit",{id:t,type:o,mode:"structure"},{})}})),s=i.filter((e=>n.isRecord(e.match)&&e.match.mode));if(s.length>0)return s[0].tool;const a=i.filter((e=>e.match));return null==(r=a[0])?void 0:r.tool}(a.tools,e,r)),[e,r,a.tools]);return{type:"action",hidden:!l||i.length>0||!u,icon:(null==u?void 0:u.icon)||o.MasterDetailIcon,title:"Open in ".concat((null==u?void 0:u.title)||"Structure"),onAction(){c("edit",{id:e,type:r,mode:"structure",path:n.pathToString(i)})},renderAsButton:!0}}});function z(e,t,o,r){const{id:i,mode:a,path:l,presentation:u,type:d,...p}=t;return"edit"===e&&i?{type:d||"*",id:n.getPublishedId(i),path:l,_searchParams:Object.entries(p)}:"create"===e?(p.preview=p.preview||new URLSearchParams(window.location.search).get("preview")||"/",r&&"object"==typeof r&&(p.templateParams=s.encodeJsonParams(r)),{type:d||"*",id:i||c.uuid(),_searchParams:Object.entries(p)}):{intent:e,params:t,payload:r}}const D=s.route.create("/",{__unsafe_disableScopedSearchParams:!0},[s.route.intents("/intent"),s.route.create(":type",[s.route.create(":id",[s.route.create(":path")])])]),F=t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool-fZOuGCKZ.cjs")})))),O=t.lazy((()=>Promise.resolve().then((function(){return require("./BroadcastDisplayedDocument-N6jy9Rvl.cjs")})))),B=n.definePlugin((o=>{const r=o.name||p;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==q.name)),q]},form:{components:{input:function(r){const i=r.value,s=(null==i?void 0:i._id)?n.getPublishedId(null==i?void 0:i._id):void 0;return n.isDocumentSchemaType(r.schemaType)?e.jsxs(k,{options:o,children:[o.locate&&s&&e.jsx(S,{documentId:s,options:o,schemaType:r.schemaType}),r.renderDefault(r),e.jsx(t.Suspense,{children:e.jsx(O,{value:i})},"broadcast-displayed-document")]}):r.renderDefault(r)}}},tools:[{icon:o.icon||d,name:r,title:o.title,component:F,options:o,canHandleIntent:(e,t)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===r)&&(!("template"in e)||{template:!0})}(t):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===r)&&(!("mode"in e)||{mode:"presentation"===e.mode})}(t),getIntentState:z,router:D}]}})),_=t.createContext(null);const E=t.createContext(null);exports.A="2023-10-16",exports.D=p,exports.L=2048,exports.M=3e3,exports.P=x,exports.a=_,exports.b=E,exports.c=1e3,exports.d=100,exports.e=function(){const e=t.useContext(E);if(!e)throw new Error("Presentation params context is missing");return e},exports.p=B,exports.u=function(){const e=t.useContext(_);if(!e)throw new Error("Presentation navigate context is missing");return e};//# sourceMappingURL=index-kilWVlh7.cjs.map
